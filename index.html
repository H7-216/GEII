<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur BUT2 GEII - S3 & S4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal { transition: opacity 0.25s ease; }
        body.modal-active { overflow: hidden; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen pb-20">

    <header class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <img src="IMG_2214.jpeg" alt="Logo IUT" class="h-12 w-auto object-contain">
                <select id="semester-selector" onchange="changeSemester(this.value)" class="bg-slate-100 border-none rounded-lg px-3 py-1.5 text-sm font-bold text-slate-800 focus:ring-2 focus:ring-blue-500 cursor-pointer hover:bg-slate-200 transition-colors">
                    <option value="S3">Semestre 3</option>
                    <option value="S4">Semestre 4</option>
                </select>
            </div>
            <div class="flex items-center gap-3 ml-auto">
                <div class="bg-white border border-slate-200 rounded-lg px-3 py-1.5 flex flex-col items-end shadow-sm border-b-2 border-b-blue-500">
                    <span class="text-[8px] text-slate-400 uppercase font-black tracking-widest leading-none mb-0.5">Moyenne Globale</span>
                    <span id="global-average" class="text-base font-black text-blue-600 leading-none">--</span>
                </div>
                <button onclick="resetData()" class="bg-red-50 text-red-600 px-3 py-1.5 rounded-lg text-[9px] font-black hover:bg-red-100 transition-colors uppercase tracking-widest border border-red-100 border-b-2 border-b-red-200 h-full">R√©initialiser</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Jury Status -->
        <div id="jury-card" class="mb-8 p-6 rounded-xl border-2 bg-white shadow-sm flex flex-col md:flex-row items-center justify-between gap-4 transition-all duration-500">
            <div class="text-center md:text-left">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-1">Statut de validation (BUT2)</h2>
                <p id="jury-status-text" class="text-xl font-bold text-slate-300 italic">En attente de notes...</p>
            </div>
            <div id="jury-icon" class="h-12 w-12 rounded-full flex items-center justify-center bg-slate-100 text-slate-400 text-xl font-bold border-2 border-slate-200">
                ?
            </div>
        </div>

        <!-- UE Summary -->
        <div id="ue-summary" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            <!-- Dynamic UE cards -->
        </div>

        <!-- Regroupements Summary (S3+S4 Validation logic) -->
        <div class="mb-4">
            <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest mb-3 px-1">P√¥les de Comp√©tences (S3+S4)</h2>
            <div id="regroupements-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Regroupement cards -->
            </div>
        </div>

        <div id="subjects-container" class="space-y-6 mt-8"></div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 pt-12 pb-8 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <div class="flex flex-col gap-4">
                    <img src="@assets/IMG_2214_1767302328247.jpeg" alt="Logo IUT" class="h-16 w-auto object-contain self-start grayscale hover:grayscale-0 transition-all">
                    <p class="text-slate-500 text-sm leading-relaxed">
                        Cr√©√© par un √©tudiant <span class="font-bold text-blue-600">GEII 2√®me ann√©e</span>.<br>
                        Ann√©e universitaire <span class="font-bold">2025 / 2026</span>.
                    </p>
                </div>
                <div class="flex flex-col gap-3">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest">Informations</h3>
                    <button onclick="toggleModal('modal-tutorial')" class="text-left text-slate-600 hover:text-blue-600 transition-colors text-sm font-medium">‚ú® Tutoriel & Fonctionnement</button>
                    <button onclick="toggleModal('modal-cookies')" class="text-left text-slate-600 hover:text-blue-600 transition-colors text-sm font-medium">üç™ Cookies & Donn√©es</button>
                    <button onclick="toggleModal('modal-cgu')" class="text-left text-slate-600 hover:text-blue-600 transition-colors text-sm font-medium">‚öñÔ∏è Mentions L√©gales</button>
                </div>
                <div class="flex flex-col gap-3">
                    <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest">Contact</h3>
                    <a href="mailto:hamza.moussa@etu.univ-cotedazur.fr" title="hamza.moussa@etu.univ-cotedazur.fr" class="group flex items-center justify-center bg-blue-50/50 hover:bg-blue-600 w-12 h-12 rounded-2xl border-2 border-blue-100 transition-all overflow-hidden relative">
                        <div class="absolute inset-0 bg-blue-600 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                        <span class="text-2xl relative z-10 transition-transform group-hover:scale-110 duration-300">‚úâÔ∏è</span>
                    </a>
                </div>
            </div>
            <div class="border-t border-slate-100 pt-8 text-center">
                <p class="text-slate-400 text-xs tracking-wide uppercase font-bold opacity-60">Simulateur non-officiel ‚Ä¢ Universit√© C√¥te d'Azur ‚Ä¢ IUT Nice C√¥te d'Azur</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div id="modal-tutorial" class="hidden fixed inset-0 z-[100] overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" onclick="toggleModal('modal-tutorial')">
                <div class="absolute inset-0 bg-slate-900 opacity-75"></div>
            </div>
            <div class="inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
                <div class="bg-white px-6 pt-6 pb-6">
                    <h3 class="text-xl font-black text-slate-800 mb-4 tracking-tight">‚ú® Comment √ßa marche ?</h3>
                    <div class="space-y-4 text-slate-600 text-sm leading-relaxed">
                        <p>L'int√©r√™t de ce site est de te permettre de suivre ton √©volution tout au long de l'ann√©e et d'anticiper tes r√©sultats du BUT2.</p>
                        <ul class="list-disc pl-5 space-y-2">
                            <li><strong>Saisie :</strong> Remplis tes notes au fur et √† mesure. Si une note n'est pas encore connue, laisse le champ vide, elle sera ignor√©e du calcul.</li>
                            <li><strong>Calcul :</strong> Le site calcule automatiquement tes moyennes de mati√®res, d'UEs et de regroupements selon les coefficients officiels.</li>
                            <li><strong>Validation :</strong> Le r√®glement BUT2 impose d'avoir au moins <span class="font-bold text-red-500">10 de moyenne</span> sur chaque regroupement d'UE (S3+S4) pour valider l'ann√©e.</li>
                        </ul>
                    </div>
                </div>
                <div class="bg-slate-50 px-6 py-4 flex justify-end">
                    <button onclick="toggleModal('modal-tutorial')" class="bg-blue-600 text-white px-6 py-2 rounded-xl font-black text-xs uppercase tracking-widest">J'ai compris</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-cookies" class="hidden fixed inset-0 z-[100] overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-slate-900 opacity-75" onclick="toggleModal('modal-cookies')"></div>
            <div class="inline-block bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full p-8">
                <h3 class="text-xl font-black text-slate-800 mb-4 tracking-tight">üç™ Cookies & Donn√©es</h3>
                <p class="text-slate-600 text-sm leading-relaxed">Ce site fonctionne √† <span class="font-bold">100% en local</span>. Aucune donn√©e n'est envoy√©e sur un serveur. Tes notes sont stock√©es uniquement dans ton navigateur via le "localStorage".</p>
                <button onclick="toggleModal('modal-cookies')" class="mt-8 w-full bg-slate-100 py-3 rounded-xl font-black text-xs uppercase tracking-widest text-slate-600">Fermer</button>
            </div>
        </div>
    </div>

    <div id="modal-cgu" class="hidden fixed inset-0 z-[100] overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4 text-center sm:p-0">
            <div class="fixed inset-0 bg-slate-900 opacity-75" onclick="toggleModal('modal-cgu')"></div>
            <div class="inline-block bg-white rounded-2xl text-left overflow-hidden shadow-xl transform transition-all sm:max-w-lg sm:w-full p-8">
                <h3 class="text-xl font-black text-slate-800 mb-4 tracking-tight">‚öñÔ∏è Mentions L√©gales</h3>
                <p class="text-slate-600 text-sm italic leading-relaxed">Ce simulateur est un outil √©tudiant non-officiel. Les calculs sont donn√©s √† titre indicatif et ne remplacent en aucun cas le jury officiel de l'IUT Nice C√¥te d'Azur.</p>
                <button onclick="toggleModal('modal-cgu')" class="mt-8 w-full bg-slate-100 py-3 rounded-xl font-black text-xs uppercase tracking-widest text-slate-600">Fermer</button>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            S3: {
                ues: ["UE31", "UE32", "UE33", "UE34"],
                labels: { UE31: "Transversale 1", UE32: "Transversale 2", UE33: "M√©tier 1", UE34: "M√©tier 2" },
                data: [
                    { id: "anglais", name: "Anglais", coeffs: { UE31: 24, UE32: 24 }, exams: [{name:"DS", coeff:18},{name:"Impl.", coeff:10},{name:"CO", coeff:10},{name:"Oral", coeff:10}] },
                    { id: "culture", name: "Culture et Com.", coeffs: { UE31: 24, UE32: 24 }, exams: [{name:"S√©ance", coeff:12},{name:"DS", coeff:18},{name:"Expos√©", coeff:18}] },
                    { id: "vie_entr", name: "Vie Entr.", coeffs: { UE31: 8, UE32: 8 }, exams: [{name:"S√©ance", coeff:16}] },
                    { id: "maths", name: "Maths", coeffs: { UE31: 36, UE32: 36 }, exams: [{name:"DS1", coeff:26},{name:"DS2", coeff:26},{name:"S√©ance", coeff:20}] },
                    { id: "physique", name: "Physique", coeffs: { UE31: 24, UE32: 24 }, exams: [{name:"DS1", coeff:13},{name:"DS2", coeff:13},{name:"TP", coeff:13},{name:"S√©ance", coeff:9}] },
                    { id: "projet_perso", name: "PPP", coeffs: { UE31: 4, UE32: 4 }, exams: [{name:"Candidature", coeff:8}] },
                    { id: "automatique", name: "Automatique", coeffs: { UE33: 25, UE34: 25 }, exams: [{name:"DS", coeff:25},{name:"TP", coeff:25}] },
                    { id: "info_indus", name: "Info Indus", coeffs: { UE33: 36, UE34: 36 }, exams: [{name:"DS", coeff:36},{name:"TP", coeff:36}] },
                    { id: "elec_ana", name: "Elec Ana", coeffs: { UE33: 24, UE34: 24 }, exams: [{name:"DS", coeff:32},{name:"TP", coeff:16}] },
                    { id: "energie", name: "Energie", coeffs: { UE33: 36, UE34: 36 }, exams: [{name:"DS1", coeff:18},{name:"DS2", coeff:18},{name:"TP", coeff:18},{name:"Quiz", coeff:18}] },
                    { id: "maintenance", name: "Maintenance", coeffs: { UE33: 8, UE34: 8 }, exams: [{name:"DS", coeff:16}] },
                    { id: "reseaux", name: "R√©seaux", coeffs: { UE33: 17, UE34: 17 }, exams: [{name:"DS", coeff:14},{name:"TP", coeff:14},{name:"S√©ance", coeff:6}] },
                    { id: "supervision", name: "Supervision", coeffs: { UE33: 17, UE34: 17 }, exams: [{name:"DS", coeff:26},{name:"TP", coeff:8}] },
                    { id: "elec_num", name: "Elec Num", coeffs: { UE33: 17, UE34: 17 }, exams: [{name:"DS", coeff:12},{name:"TP", coeff:20}] },
                    { id: "sae_lora", name: "SAE LoRa", coeffs: { UE31: 40, UE32: 40, UE33: 60, UE34: 60 }, exams: [{name:"S√©ance", coeff:80},{name:"Rapport", coeff:50},{name:"TP", coeff:70}] },
                    { id: "sae_four", name: "SAE Four", coeffs: { UE31: 40, UE32: 40, UE33: 60, UE34: 60 }, exams: [{name:"S√©ance", coeff:70},{name:"Eval", coeff:65},{name:"DS", coeff:65}] }
                ]
            },
            S4: {
                ues: ["UE41", "UE42", "UE43", "UE44"],
                labels: { UE41: "Transversale 1", UE42: "Transversale 2", UE43: "M√©tier 1", UE44: "M√©tier 2" },
                data: [
                    { id: "anglais_s4", name: "Anglais", coeffs: { UE41: 18, UE42: 18 }, exams: [{name:"DS", coeff:18},{name:"D√©bat", coeff:9},{name:"CO", coeff:9}] },
                    { id: "culture_s4", name: "Culture et Com.", coeffs: { UE41: 18, UE42: 18 }, exams: [{name:"Eval", coeff:18},{name:"Vid√©o", coeff:18}] },
                    { id: "vie_entr_s4", name: "Vie Entr.", coeffs: { UE41: 14, UE42: 14 }, exams: [{name:"DS", coeff:28}] },
                    { id: "maths_s4", name: "Maths", coeffs: { UE41: 24, UE42: 24 }, exams: [{name:"DS1", coeff:18},{name:"DS2", coeff:18},{name:"S√©ance", coeff:12}] },
                    { id: "ppp_s4", name: "PPP", coeffs: { UE41: 6, UE42: 6 }, exams: [{name:"S√©ance", coeff:8},{name:"Contrat", coeff:4}] },
                    { id: "ia_iot", name: "Bases IA/IoT", coeffs: { UE43: 36, UE44: 36 }, exams: [{name:"DS", coeff:48},{name:"S√©ance", coeff:24}] },
                    { id: "energie_spec", name: "Energie Sp√©c.", coeffs: { UE43: 36, UE44: 36 }, exams: [{name:"DS", coeff:30},{name:"TP", coeff:21},{name:"Quiz", coeff:21}] },
                    { id: "auto_s4", name: "Automatique", coeffs: { UE43: 27, UE44: 27 }, exams: [{name:"DS", coeff:27},{name:"TP", coeff:27}] },
                    { id: "auto_spec", name: "Auto Sp√©.", coeffs: { UE43: 27, UE44: 27 }, exams: [{name:"DS", coeff:27},{name:"TP", coeff:27}] },
                    { id: "elec_spec", name: "Elec Sp√©.", coeffs: { UE43: 27, UE44: 27 }, exams: [{name:"DS", coeff:36},{name:"TP", coeff:18}] },
                    { id: "elec_num_s4", name: "Elec Num", coeffs: { UE43: 27, UE44: 27 }, exams: [{name:"Eval", coeff:54}] },
                    { id: "sae_roue", name: "SAE Roue", coeffs: { UE41: 50, UE42: 50, UE43: 50, UE44: 50 }, exams: [{name:"DS1", coeff:68},{name:"S√©ance", coeff:68},{name:"Dossier", coeff:54}] },
                    { id: "stage", name: "Stage", coeffs: { UE41: 68, UE42: 68, UE43: 68, UE44: 68 }, exams: [{name:"Entrep.", coeff:90},{name:"Sout.", coeff:85},{name:"Rapport", coeff:85},{name:"Rech.", coeff:12}] },
                    { id: "portfolio", name: "Portfolio", coeffs: { UE41: 2, UE42: 2, UE43: 2, UE44: 2 }, exams: [{name:"S√©ance", coeff:8}] }
                ]
            }
        };

        const REGROUPEMENTS = [
            { id: "R1", label: "Regroupement 1", s3: "UE31", s4: "UE41" },
            { id: "R2", label: "Regroupement 2", s3: "UE32", s4: "UE42" },
            { id: "R3", label: "Regroupement 3", s3: "UE33", s4: "UE43" },
            { id: "R4", label: "Regroupement 4", s3: "UE34", s4: "UE44" }
        ];

        let currentSemester = "S3";
        let grades = JSON.parse(localStorage.getItem('but2_grades') || '{}');

        function save() { localStorage.setItem('but2_grades', JSON.stringify(grades)); }
        function changeSemester(sem) { currentSemester = sem; init(); }
        function toggleModal(modalId) { 
            const el = document.getElementById(modalId);
            el.classList.toggle('hidden');
            document.body.classList.toggle('modal-active');
        }

        function handleInput(subId, examIdx, val) {
            if (!grades[subId]) grades[subId] = {};
            if (val === "" || isNaN(val)) delete grades[subId][examIdx];
            else grades[subId][examIdx] = Math.min(20, Math.max(0, parseFloat(val)));
            save(); calculate();
        }

        function calculate() {
            const ueAverages = {};
            const sem = CONFIG[currentSemester];
            
            // Calculate Subject Averages
            const subjectAvgs = {};
            sem.data.forEach(sub => {
                let weighted = 0, weights = 0;
                const subGrades = grades[sub.id] || {};
                sub.exams.forEach((ex, i) => {
                    if (subGrades[i] !== undefined) { weighted += subGrades[i] * ex.coeff; weights += ex.coeff; }
                });
                const avg = weights > 0 ? weighted / weights : null;
                subjectAvgs[sub.id] = avg;
                
                const el = document.getElementById(`avg-${sub.id}`);
                const card = document.getElementById(`card-${sub.id}`);
                if (el) {
                    el.textContent = avg !== null ? avg.toFixed(2) : "--";
                    el.className = `text-lg font-bold ${avg !== null ? (avg < 10 ? 'text-red-500' : 'text-blue-600') : 'text-slate-300'}`;
                }
                if (card) card.style.borderColor = avg !== null && avg < 8 ? '#fecaca' : '';
            });

            // Semester UE Calculation
            sem.ues.forEach(ue => {
                let weighted = 0, weights = 0;
                sem.data.forEach(sub => {
                    if (sub.coeffs[ue] && subjectAvgs[sub.id] !== null) {
                        weighted += subjectAvgs[sub.id] * sub.coeffs[ue];
                        weights += sub.coeffs[ue];
                    }
                });
                ueAverages[ue] = weights > 0 ? weighted / weights : null;
            });

            // Global Semester Average
            let semTotalWeighted = 0, semTotalWeights = 0;
            Object.values(ueAverages).forEach(val => { if(val !== null) { semTotalWeighted += val; semTotalWeights++; } });
            const globalAvg = semTotalWeights > 0 ? semTotalWeighted / semTotalWeights : null;
            const gEl = document.getElementById('global-average');
            gEl.textContent = globalAvg !== null ? globalAvg.toFixed(2) : "--";
            gEl.className = `text-xl font-black ${globalAvg !== null ? (globalAvg < 10 ? 'text-red-500' : 'text-blue-600') : 'text-slate-300'}`;

            // Regroupements
            const regAverages = {};
            REGROUPEMENTS.forEach(reg => {
                const s3Avg = getUEAverage("S3", reg.s3);
                const s4Avg = getUEAverage("S4", reg.s4);
                
                let combined = null;
                if (s3Avg !== null && s4Avg !== null) combined = (s3Avg + s4Avg) / 2;
                else if (s3Avg !== null) combined = s3Avg;
                else if (s4Avg !== null) combined = s4Avg;
                
                regAverages[reg.id] = combined;
                const regVal = document.getElementById(`reg-val-${reg.id}`);
                if (regVal) {
                    regVal.textContent = combined !== null ? combined.toFixed(2) : "--";
                    regVal.className = `text-xl font-bold ${combined !== null && combined < 10 ? 'text-red-600' : 'text-emerald-600'}`;
                }
            });

            renderUESummary(ueAverages);
            updateJuryStatus(regAverages);
        }

        function getUEAverage(semKey, ueKey) {
            const sem = CONFIG[semKey];
            let weighted = 0, weights = 0;
            sem.data.forEach(sub => {
                if (sub.coeffs[ueKey]) {
                    let subW = 0, subWeights = 0;
                    const sg = grades[sub.id] || {};
                    sub.exams.forEach((ex, i) => { if(sg[i] !== undefined) { subW += sg[i] * ex.coeff; subWeights += ex.coeff; } });
                    if (subWeights > 0) {
                        weighted += (subW / subWeights) * sub.coeffs[ueKey];
                        weights += sub.coeffs[ueKey];
                    }
                }
            });
            return weights > 0 ? weighted / weights : null;
        }

        function renderUESummary(avgs) {
            const container = document.getElementById('ue-summary');
            container.innerHTML = CONFIG[currentSemester].ues.map(ue => {
                const avg = avgs[ue];
                const color = avg === null ? 'slate-300' : (avg < 10 ? 'red-600' : 'blue-600');
                return `
                    <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm transition-all hover:border-blue-200">
                        <div class="text-[10px] font-black text-slate-400 uppercase tracking-widest leading-tight">${ue}</div>
                        <div class="text-[11px] text-slate-500 mb-2 truncate font-medium">${CONFIG[currentSemester].labels[ue]}</div>
                        <div class="text-2xl font-black text-${color} leading-none">${avg !== null ? avg.toFixed(2) : '--'}</div>
                    </div>
                `;
            }).join('');
        }

        function updateJuryStatus(regAverages) {
            const statusText = document.getElementById('jury-status-text');
            const statusIcon = document.getElementById('jury-icon');
            const card = document.getElementById('jury-card');
            
            const regs = Object.values(regAverages);
            const anyRegBelow10 = regs.some(v => v !== null && v < 10);
            const allRegsFilled = regs.every(v => v !== null);

            if (anyRegBelow10) {
                statusText.textContent = "Validation IMPOSSIBLE : Un regroupement est inf√©rieur √† 10.";
                statusText.className = "text-xl font-bold text-red-600";
                statusIcon.innerHTML = "‚úñ"; statusIcon.className = "h-12 w-12 rounded-full flex items-center justify-center bg-red-100 text-red-600 font-bold border-2 border-red-200";
                card.className = "mb-8 p-6 rounded-xl border-2 border-red-200 bg-red-50/30 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4 transition-all duration-500";
            } else if (allRegsFilled) {
                statusText.textContent = "Validation ADMISE : Tous les regroupements sont valid√©s.";
                statusText.className = "text-xl font-bold text-emerald-600";
                statusIcon.innerHTML = "‚úî"; statusIcon.className = "h-12 w-12 rounded-full flex items-center justify-center bg-emerald-100 text-emerald-600 font-bold border-2 border-emerald-200";
                card.className = "mb-8 p-6 rounded-xl border-2 border-emerald-200 bg-emerald-50/30 shadow-sm flex flex-col md:flex-row items-center justify-between gap-4 transition-all duration-500";
            } else {
                statusText.textContent = "En attente de notes pour calcul final...";
                statusText.className = "text-xl font-semibold text-slate-400 italic";
                statusIcon.innerHTML = "?"; statusIcon.className = "h-12 w-12 rounded-full flex items-center justify-center bg-slate-100 text-slate-400 border-2 border-slate-200";
                card.className = "mb-8 p-6 rounded-xl border-2 border-slate-200 bg-white shadow-sm flex flex-col md:flex-row items-center justify-between gap-4 transition-all duration-500";
            }
        }

        function init() {
            const container = document.getElementById('subjects-container');
            container.innerHTML = "";
            
            const regContainer = document.getElementById('regroupements-container');
            regContainer.innerHTML = REGROUPEMENTS.map(reg => `
                <div class="bg-white border border-slate-200 p-4 rounded-xl flex items-center justify-between shadow-sm hover:border-blue-200 transition-all">
                    <div>
                        <div class="text-[10px] font-black text-slate-400 uppercase tracking-wider">${reg.label}</div>
                        <div class="text-xs text-slate-500 font-medium">${reg.s3} <span class="text-slate-300 mx-1">/</span> ${reg.s4}</div>
                    </div>
                    <div id="reg-val-${reg.id}" class="text-2xl font-black text-slate-300">--</div>
                </div>
            `).join('');

            CONFIG[currentSemester].data.forEach(sub => {
                const card = document.createElement('div');
                card.id = `card-${sub.id}`;
                card.className = "bg-white border border-slate-200 rounded-xl p-6 shadow-sm fade-in hover:shadow-md transition-all";
                
                const examsHtml = sub.exams.map((ex, i) => `
                    <div class="flex-1 min-w-[100px]">
                        <label class="block text-[10px] font-black text-slate-400 uppercase mb-2 truncate tracking-widest">${ex.name} <span class="text-slate-300">x${ex.coeff}</span></label>
                        <input type="number" step="0.1" value="${(grades[sub.id] && grades[sub.id][i]) || ''}" 
                            oninput="handleInput('${sub.id}', ${i}, this.value)"
                            placeholder="0.0"
                            class="w-full bg-slate-50 border border-slate-200 rounded-lg px-3 py-2 text-sm font-bold text-slate-700 focus:ring-4 focus:ring-blue-500/10 focus:border-blue-500 outline-none transition-all">
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="font-black text-slate-800 tracking-tight">${sub.name}</h3>
                        <div id="avg-${sub.id}" class="text-xl font-black text-slate-300">--</div>
                    </div>
                    <div class="flex flex-wrap gap-4">${examsHtml}</div>
                `;
                container.appendChild(card);
            });
            calculate();
        }

        function resetData() { if(confirm("Effacer TOUTES les notes (S3 et S4) ?")) { grades = {}; save(); init(); } }
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>